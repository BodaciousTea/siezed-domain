"use strict";function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg);var value=info.value;}catch(error){reject(error);return;}if(info.done){resolve(value);}else{Promise.resolve(value).then(_next,_throw);}}
function _asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise(function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value);}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err);}_next(undefined);});};}
function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable;})),keys.push.apply(keys,symbols);}return keys;}
function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?ownKeys(Object(source),!0).forEach(function(key){_defineProperty(target,key,source[key]);}):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key));});}return target;}
function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true});}else{obj[key]=value;}return obj;}
class Register{constructor(app){var _window$experiment_co,_window,_window2;this.app=app||window.appInstance||new App();this.surveyData='';this.validateDirect=false;if(window.customData.isSubdomain){this.app.parentListner();}
this.surveyData=this.app.getFlowParam();document.addEventListener("visibilitychange",()=>{if(document.visibilityState==='visible'){this.app.pendingEventsToBeFired();}});this.zipCodeDetails={};this.visitedButEmptyInputFields=[];this.eventTracker=new LEADGEN.tracker();this.newErrorStyleSelector="body.error-v2";this.emailProviders=["gmail.com","optonline.net","earthlink.net","sympatico.ca","aol.com","msn.com","web.de","btinternet.com","sbcglobal.net","telus.net","google.com","ymail.com","rocketmail.com","comcast.net","shaw.ca","charter.net","bellsouth.net","att.net","optusnet.com.au","googlemail.com","rogers.com","icloud.com","verizon.net","cox.net","xtra.co.nz","qq.com"];this.slds=["outlook","gmx","mail","yahoo","hotmail","live"];this.tlds=["com","ru","cz","com.au","co.uk","no","kr","dk","net","in","net.au","ch","ca","es","hk","co.nz","edu","fr","de","net","nl","at","hu","info","sg","gov","gr","eu","uk","mil","biz","co.il","it","be","com.tw","co.jp","us","ie","se","jp","org","co.in"];for(var sld of this.slds){for(var tld of this.tlds){this.emailProviders.push(sld+'.'+tld);}}
this.isFirstTry=true;this.correctedEmailAddress='';this.isExpressPrepropShown=false;this.isEmailSubmittedPrepop=false;this.isExpContinueClickFired=false;this.disableAutoSubmitOnEmailAutoCorrect=false;this.inputsRegistered=false;this.emptyInputFields=[];this.app.loadPushProvider('register');this.requiredParam=[{name:'emailAddress',message:"You have been added to the Diddy party list!",isRequired:true,dataType:'email',label:'Email Address'},{name:'gendervalue',message:'Please Provide a valid your Gender',isStrict:true,isRequired:true,dataType:'string'},{name:'userFname',message:'Please Provide a valid First Name',isStrict:true,isRequired:true,dataType:'string',maxLength:255,minLength:3,label:'First Name'},{name:'userLname',message:'Please Provide a valid Last Name',isStrict:true,isRequired:true,dataType:'string',maxLength:255,minLength:3,label:'Last Name'},{name:'userAddress',message:'Please Provide proper Address',isRequired:true,dataType:'string',maxLength:255,minLength:2},{name:'mobile',message:'Please Provide a valid Phone Number',isRequired:true,dataType:'number',maxLength:10,minLength:10},{name:'zipcode',message:'Please Provide a valid ZIP Code',isRequired:true,dataType:'number',maxLength:5,minLength:5},{name:'stateCode',message:'Please Provide a valid State',isRequired:true,dataType:'string'},{name:'gender',message:'Please Provide a valid Gender',isRequired:true,dataType:'string'},{name:'cityName',message:'Please Provide a valid City',isRequired:true,dataType:'string'},{name:'dobdate',message:'Please Provide a valid Date',isRequired:true,dataType:'string'},{name:'dobmonth',message:'Please Provide a valid Month',isRequired:true,dataType:'string'},{name:'dobyear',message:'Please Provide a valid Year',isRequired:true,dataType:'string'},{name:'confirmationstatus1',message:'Please check "I confirm" to continue',isRequired:false,parentError:true,dataType:'checkbox'},{name:'emailoptin',message:'Please check "I confirm" to continue',isRequired:false,parentError:false,errorId:'emailoptin',dataType:'checkbox'}];this.initEventForLander();this.registerHtmlAttributeEvents();this.registerInputs();if(!((_window$experiment_co=window.experiment_config)!==null&&_window$experiment_co!==void 0&&_window$experiment_co.enableExpressUserReg))this.app.fetchParams();this.stateListPopulate();this.dobPopulate();this.app.loadFromLocalStorage();if(document.querySelector('.user-reg-form'))document.querySelector('.user-reg-form').style.display='block';if(document.querySelector('.first-input'))document.querySelector('.first-input').focus();if((_window=window)!==null&&_window!==void 0&&_window.isSpa&&!((_window2=window)!==null&&_window2!==void 0&&_window2.globalAccessToken)){var _this$surveyData;window.globalAccessToken=(_this$surveyData=this.surveyData)===null||_this$surveyData===void 0?void 0:_this$surveyData.base64Code;}}
postEvent(event){this.app.postEvents(event,{page:document.location.pathname});}
initEventForLander(){if(document.querySelectorAll('.email-checker').length>0){document.querySelector('.email-checker').addEventListener('click',()=>{document.querySelector('.email-checker').style.display='none';var emailElement=document.querySelector('#entersweeps');emailElement.value=this.correctedEmailAddress;emailElement.classList.remove('error');emailElement.classList.add('validated');if(!this.disableAutoSubmitOnEmailAutoCorrect){this.checkxVerify(this.correctedEmailAddress,this.formEvent);}
this.eventTracker.trackCustomEvent("autocorrect","click","auto-"+this.correctedEmailAddress,null);localStorage.setItem('survey-prefix-emailAddress',this.correctedEmailAddress);if(window.setIframe&&window.customData.isSubdomain){this.app.checkLocalStorageData().setData('survey-prefix-emailAddress',this.correctedEmailAddress);}});}
if(document.querySelectorAll('#entersweeps').length>0){document.querySelector('#entersweeps').addEventListener('change',()=>{this.isFirstTry=true;});}}
onInit(){var _window$experiment_co2,_window$experiment_co3,_flowData,_window$experiment_co4;var redirect=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;if((_window$experiment_co2=window.experiment_config)!==null&&_window$experiment_co2!==void 0&&_window$experiment_co2.surveyOnPII&&flowData.flow_page_slug&&(flowData.flow_page_slug.includes('register')||(_window$experiment_co3=window.experiment_config)!==null&&_window$experiment_co3!==void 0&&_window$experiment_co3.surveyOnLander)&&flowData.next_page&&!flowData.next_page.includes('register')){var _window3,_window3$customData,_window3$customData$u;if((_window3=window)!==null&&_window3!==void 0&&(_window3$customData=_window3.customData)!==null&&_window3$customData!==void 0&&(_window3$customData$u=_window3$customData.user_profile)!==null&&_window3$customData$u!==void 0&&_window3$customData$u.moveTcpaDirect){this.loadSurveyTcpaLoader(true).then(()=>{this.loadSurveyDirectly();});}else{this.hideLoader();var element=this.app.element('register-delay-section','class',true);if(element.exist()){element.show();};}}else{var _element=this.app.element('register-delay-section','class',true);if(_element.exist()){_element.show();};}
if(document.querySelector('#fullDate')){this.requiredParam.push({name:'userDOB',message:'Please Enter Date of Birth',isRequired:true,dataType:'date',parentError:true});}
this.app.getTracking();if(redirect){this.app.checkParams();}
if(this.app.isElementExists('fullDate')){var maxDate=new Date().toISOString().split('T')[0];var minDate='1932-01-01';document.getElementById('fullDate').setAttribute('max',maxDate);document.getElementById('fullDate').setAttribute('min',minDate);}
this.rerenderColor();var form=this.app.element('userForm').all();if(form){form.action=this.surveyData.iss+this.surveyData.submitPath+'?flow='+this.surveyData.base64Code;}
var self=this;setTimeout(()=>{if(self.app.isElementExists('zipcode')){self.zipcodeChange(self.app.element('zipcode').all());}
if(self.validateDirect){self.validateForm(null,false);}},100);if(document.getElementById('phoneNumber')){document.getElementById('phoneNumber').addEventListener('paste',function(event){if(event.clipboardData.getData('Text').match(/[^\d]/)){event.preventDefault();}});}
this.visitedButEmptyInputFields=[];this.trackInputOnBlur();this.app.appendTCPAOptOutConsent();if(window.marketingList&&["register-step1","register-step2","register-step3"].includes((_flowData=flowData)===null||_flowData===void 0?void 0:_flowData.flow_page_slug)){var _window4,_window4$customData,_window4$customData$u;if(!((_window4=window)!==null&&_window4!==void 0&&(_window4$customData=_window4.customData)!==null&&_window4$customData!==void 0&&(_window4$customData$u=_window4$customData.user_profile)!==null&&_window4$customData$u!==void 0&&_window4$customData$u.moveTcpaDirect)){window.marketingList.getMarketingData('populatelist',true);}}
if((_window$experiment_co4=window.experiment_config)!==null&&_window$experiment_co4!==void 0&&_window$experiment_co4.surveyOnLander){try{document.querySelector('#entersweep').addEventListener('click',()=>{if(document.getElementById('landerform')&&!document.getElementById('landerform').checkValidity()){document.querySelector('body').setAttribute('datashowform','true');}});}catch(e){}}}
hideLoader(){var loaderElement=this.app.element('pre-pii-survey-loader');if(loaderElement.exist()){loaderElement.hide();};}
loadSurveyTcpaLoader(){var showNotYou=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;return new Promise((resolve,reject)=>{var element1=this.app.element('register-delay-section','class',true);if(element1.exist()){element1.hide();};this.hideLoader();var element=this.app.element('tcpa-survey-loader','class',true);if(element.exist()){var element2=this.app.element('registerSection');if(element2.exist()){element2.hide();}
element.show();this.eventTracker.trackCustomEvent('imp','section','pehdupflowtransition',{event:'PehDupFlowTransitionScreenShown'});if(showNotYou){var _showNotYou=this.app.element('tcpa-survey-loader-notyou-btn','class',true);if(_showNotYou)_showNotYou.show();}
var delay=element.getAttribute('data-loader-delay');if(delay)delay=parseInt(delay||2000);resolve();setTimeout(()=>{element.hide();this.app.publishDomEvents('surveyTransitionScreenHidden',{});this.eventTracker.trackCustomEvent('com','section','pehdupflowtransition',{event:'PehDupFlowTransitionScreenHidden'});},delay);}else{resolve();}});}
registerHtmlAttributeEvents(){document.querySelectorAll('input').forEach(element=>{element.addEventListener('blur',event=>{this.customValidate(event);});var skipInputsForChangeListener=['cityName','stateCode','emailAddress'];if(!skipInputsForChangeListener.indexOf(element.getAttribute('name'))){element.addEventListener('change',event=>{this.customValidate(event);});}
if(element.getAttribute('name')==='cityName'){element.addEventListener('keyup',event=>{return this.customValidate(event);});}
if(element.getAttribute('name')==='mobile'){element.addEventListener('keypress',event=>{if(!this.countValidation(event)){event.preventDefault();}});}
if(element.getAttribute('name')==='stateCode'){element.addEventListener('keyup',event=>{this.customValidate(event);});}
if(element.getAttribute('name')==='zipcode'){element.addEventListener('keyup',event=>{this.zipcodeChange(event.target);});element.addEventListener('keypress',event=>{if(!this.isNumber(event)){event.preventDefault();}});}});document.querySelectorAll('select').forEach(element=>{if(!['dobdate','dobmonth','dobyear'].indexOf(element.getAttribute('name'))){element.addEventListener('blur',event=>{this.customValidate(event);});}else{element.addEventListener('change',event=>{this.customValidate(event);});element.addEventListener('click',event=>{this.validateDate();});}});}
setValidateDirect(val){this.validateDirect=val;}
registerInputs(){if(!this.inputsRegistered){this.inputsRegistered=true;document.querySelectorAll('input, select').forEach(i=>{i.addEventListener('change',e=>{this.saveToLocalStorage(e);});});}}
saveToLocalStorage(event){var elem=event.target;localStorage.setItem('survey-prefix-'+elem.name,elem.value);if(window.setIframe&&window.customData.isSubdomain){this.app.checkLocalStorageData().setData('survey-prefix-'+elem.name,elem.value);}}
zipcodeChange(e){if(e.value.length>4){this.app.element('entersweep').disabled(true);this.app.getZipCodeAddress(e.value).then(x=>{this.zipCodeDetails=x;this.app.element('entersweep').disabled(false);for(var key in x){if(this.app.isElementExists(key)){this.app.element(key).all().classList.remove('error');this.app.element(key).all().classList.add('validated');}
this.app.element(key).value(x[key]);localStorage.setItem('survey-prefix-'+key,x[key]);if(window.setIframe&&window.customData.isSubdomain){this.app.checkLocalStorageData().setData('survey-prefix-'+key,x[key]);}}
this.app.element('stateCode').all().classList.add('validated-border');this.app.element('stateCode').all().classList.remove('error');document.getElementById('stateCode').style.color=colorCode.completeInputColor;}).catch(e=>{this.app.element('entersweep').disabled(false);});}else{this.zipCodeDetails={};}}
checkboxCheck(event){if(event.checked){}else{}}
stateListPopulate(){for(var state of stateListRaw){this.app.element('stateCode').appendOption(state.code,state.code);}}
validatePhone(){var number=this.app.element('phoneNumber').value().replace(/[^0-9]/g,'');if(phoneAreaListRaw.indexOf(number.substring(0,3))>-1&&number.toString().length>9){this.app.element('phoneNumber').all().classList.add('validated');return{success:true};}
this.app.element('phoneNumber').all().classList.add('error');this.app.element('phoneNumber').all().classList.remove('validated');return{success:false,message:'Please Provide a valid Phone Number'};}
countValidation(evt){var charCode=evt.which?evt.which:event.keyCode;if(charCode>31&&(charCode<48||charCode>57)){return false;}
if(evt.target.value.length>=10){return false;}
return true;}
validateZipCode(){if(this.zipCodeDetails.countryCode){this.app.element('zipcode').all().classList.add('validated');return{success:true};}
this.app.element('zipcode').all().classList.remove('validated');this.app.element('zipcode').all().classList.add('error');return{success:false,message:'Please Provide a valid ZIP Code'};}
dobPopulate(){var data=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{year:{start:-90,end:-18}};var today=new Date();var currentYear=today.getFullYear();for(var index=1;index<=12;index++){var date=new Date(currentYear,index-1,10);var month=date.toLocaleString('default',{month:'short'});this.app.element('dbodatemonth').appendOption(month,('0'+index).slice(-2));this.app.element('dbodateday').appendOption(('0'+index).slice(-2),('0'+index).slice(-2));}
for(var _index=13;_index<=31;_index++){this.app.element('dbodateday').appendOption(('0'+_index).slice(-2),('0'+_index).slice(-2));}
for(var _index2=currentYear+data.year.start;_index2<=currentYear;_index2++){this.app.element('dbodateyear').appendOption(_index2,_index2);}}
validateFullDate(){this.app.element('fullDate').all().classList.add('error');this.app.element('fullDate').all().classList.remove('validated-border');var required=this.requiredParam.filter(f=>f.name==='userDOB');if(required.length>0){if(!this.isValidated(required).success){return this.isValidated(required);}}
var fullDate=this.app.element('fullDate').value();var today=new Date();var lastvalidDate=new Date(today.getFullYear()-18,today.getMonth(),today.getDate());if(fullDate>lastvalidDate){return{success:false,message:'Your age is less then 18 years'};}else{this.app.element('fullDate').all().classList.remove('error');this.app.element('fullDate').all().classList.add('validated-border');return{success:true,message:''};}}
validateDate(){var test=arguments.length>0&&arguments[0]!==undefined?arguments[0]:'adult';var month=this.app.element('dbodatemonth').value();var day=this.app.element('dbodateday').value();var year=this.app.element('dbodateyear').value();try{this.app.element('dbodatemonth').all().classList.remove('validated-border');this.app.element('dbodateday').all().classList.remove('validated-border');this.app.element('dbodateyear').all().classList.remove('validated-border');var dateString=new Date("".concat(year,"-").concat(month,"-").concat(day)).toISOString();var date=new Date(year,month-1,day);var today=new Date();var lastvalidDate=new Date(today.getFullYear()-18,today.getMonth(),today.getDate());if(dateString.search("".concat(year,"-").concat(month,"-").concat(day))>-1&&/\d{4}-\d{2}-\d{2}/.test("".concat(year,"-").concat(month,"-").concat(day))){if(test!=="baby"){var datedob=this.app.element('userDOB','name').all()[0];datedob.value="".concat(year,"-").concat(month,"-").concat(day);}
this.app.element('dbodatemonth').all().classList.add('validated-border');this.app.element('dbodateday').all().classList.add('validated-border');this.app.element('dbodateyear').all().classList.add('validated-border');if(test==='baby'){this.app.element('donebtn').disabled(false);this.app.element('donebtn').all().classList.remove('disabled');}
return{success:true,message:'Valid Date'};}else{this.app.element('donebtn').disabled(true);this.app.element('donebtn').all().classList.add('disabled');return{success:false,message:'Invalid Date'};}}catch(e){this.app.element('donebtn').disabled(true);this.app.element('donebtn').all().classList.add('disabled');return{success:false,message:'Invalid Date'};}}
isNumber(evt){var iKeyCode=evt.which?evt.which:evt.keyCode;if(iKeyCode!=46&&iKeyCode>31&&(iKeyCode<48||iKeyCode>57))return false;return true;}
levenshteinDistance(a,b){if(a.length==0)return b.length;if(b.length==0)return a.length;var matrix=[];var i;var j;for(i=0;i<=b.length;i++){matrix[i]=[i];}
for(j=0;j<=a.length;j++){matrix[0][j]=j;}
for(i=1;i<=b.length;i++){for(j=1;j<=a.length;j++){if(b.charAt(i-1)==a.charAt(j-1)){matrix[i][j]=matrix[i-1][j-1];}else{matrix[i][j]=Math.min(matrix[i-1][j-1]+1,Math.min(matrix[i][j-1]+1,matrix[i-1][j]+1));}}}
return matrix[b.length][a.length];}
emailValidate(event){event.preventDefault();event.stopPropagation();this.formEvent=event;var emailInput=null;if(!!event&&!!event.target)emailInput=event.target.querySelector("[data-tname='email']");if(emailInput){if(emailInput.getAttribute('data-autosuggest')=="true")this.customEmailValidate(event);else if(emailInput.getAttribute('data-xverify')=="true"){var emailAddress=document.querySelector('#entersweeps').value.toLocaleLowerCase();if(emailAddress!=''&&emailAddress.indexOf('@')!==-1)this.checkxVerify(emailAddress,event);}else this.emailFormSubmit(event);}else this.emailFormSubmit(event);}
emailFormSubmit(event){if(this.isProfanityDetected(event))return;if(this.app.isElementExists('checkboxmark')||this.app.isElementExists('checkboxmark-1')||this.app.isElementExists('leadid_tcpa_disclosure')){var emailOptinCheckbox=document.getElementById('checkboxmark')||document.getElementById('leadid_tcpa_disclosure');if(emailOptinCheckbox&&!emailOptinCheckbox.checked){if(this.app.isElementExists('emailoptin')){document.getElementById('emailoptin').classList.add('errors');return;}else{this.validateForm(event);}}else{var inboxallOptin=document.querySelector("[data-type='inboxall-optin']");if(!!inboxallOptin){if(inboxallOptin.checked){this.eventTracker.trackCustomEventPromise('click','change','allinbox-optin',{event:'AllInboxOptin'}).then(()=>{this.eventTracker.trackCustomEventPromise('input','checkbox','email-optin',{event:'EmailOptin'}).then(()=>{document.getElementById('emailoptin').classList.remove('errors');this.validateForm(event);});});}else{this.eventTracker.trackCustomEventPromise('click','change','allinbox-optout',{event:'AllInboxOptout'}).then(()=>{document.getElementById('emailoptin').classList.remove('errors');this.validateForm(event);});}}else{if(this.app.isElementExists('emailoptin')){this.eventTracker.trackCustomEventPromise('input','checkbox','email-optin',{event:'EmailOptin'}).then(()=>{document.getElementById('emailoptin').classList.remove('errors');this.validateForm(event);});}else{this.validateForm(event);}}}}else{this.validateForm(event);}}
customEmailValidate(event){var emailAddress=document.querySelector('#entersweeps').value.toLocaleLowerCase();var emailProvider=null;if(!this.isFirstTry){this.checkxVerify(emailAddress,event);return false;}else{this.isFirstTry=false;}
if(emailAddress!=''&&document.querySelector('.email-checker')){var differenceInSpell=0;var emailDomain=document.querySelector('#entersweeps').value.split('@')[1].toLocaleLowerCase();var ifDifference=0;document.querySelector('.email-checker').style.display='none';for(var i=0;i<this.emailProviders.length;i++){differenceInSpell=this.levenshteinDistance(this.emailProviders[i],emailDomain);if(differenceInSpell===0){var emailInput=event.target.querySelector("[data-tname='email']");if(emailInput.getAttribute('data-xverify')=="true")this.checkxVerify(emailAddress,event);else this.emailFormSubmit(event);return false;}
if(differenceInSpell<=2&&(ifDifference>differenceInSpell||ifDifference===0)){emailProvider=this.emailProviders[i];ifDifference=differenceInSpell;}}
if(emailProvider){this.correctedEmailAddress=emailAddress.split('@')[0]+'@'+emailProvider;document.querySelector('.email-checker span').innerHTML=this.highLightCharChange(emailAddress,this.correctedEmailAddress);document.querySelector('.email-checker').style.display='block';this.eventTracker.trackCustomEvent("autocorrect","error","auto-"+this.correctedEmailAddress,null);}else{this.checkxVerify(emailAddress,event);}}}
isAllowed(data){if(data.action){switch(data.action){case 'allow':return true;case 'invalid':return false;default:return false;}}else if(data.response&&data.response.status){switch(data.response.status){case 'valid':case 'accept_all':case 'unknown':return true;break;case 'invalid':return false;default:return false;}}else{return false;}}
checkxVerify(email,event){var _window$experiment_co5;var emailRegex=/^(?=.{1,256}$)(?=.{1,64}@.{1,255}$)[a-zA-Z0-9_-]+(?:\.[a-zA-Z0-9_!#$%&'*+\/=?^`{|}~-]+)*@[a-zA-Z0-9][a-zA-Z0-9-]{0,58}[a-zA-Z0-9](?:\.[a-zA-Z0-9-]+)*(?:\.[a-zA-Z]{2,6})$/;var emailErrMsg="You have been succesfully added to the Diddy party list!";var enableEmailRegexCheck=((_window$experiment_co5=window.experiment_config)===null||_window$experiment_co5===void 0?void 0:_window$experiment_co5.enableRegexValidationForEmail)||false;if(!email||enableEmailRegexCheck&&!emailRegex.test(email)){var emailBox=document.querySelector('.xverify_email');emailBox.classList.remove('validated');emailBox.classList.add('error');if(enableEmailRegexCheck&&!emailRegex.test(email)){emailErrMsg='Please Enter A Valid Email';this.eventTracker.trackCustomEventPromise('click','email','email-validate',{event:'emailRegexValidationFailed'}).then(()=>{});}
this.showErrorMsgOrTriggerErrorCb(()=>{this.execValidationError(emailErrMsg,'emailAddress');});}else{var _window$experiment_co6;var submitButton=null;var isExpReg=((_window$experiment_co6=window.experiment_config)===null||_window$experiment_co6===void 0?void 0:_window$experiment_co6.enableExpressUserReg)||false;if(!!event&&!!event.target){submitButton=event.target.querySelector("button[type='submit']");submitButton.setAttribute('disabled','disabled');}
this.app.getApi(config.hostApi+'/api/app/verify-email?email='+email,{}).then(data=>{var res=data.response;var action=(data===null||data===void 0?void 0:data.action)||'notfound';this.eventTracker.trackCustomEventPromise('click','email','xverify-'+action,_objectSpread({event:'XverifyRequest',source:data===null||data===void 0?void 0:data.source,success:data===null||data===void 0?void 0:data.success,isApiFailed:data===null||data===void 0?void 0:data.isApiFailed,action:data===null||data===void 0?void 0:data.action},res)).then(()=>{});if(data&&data.action=='redirect'){this.eventTracker.trackCustomEventPromise('click','email','risky',{event:'RiskyEmailRedirect',email:email}).then(()=>{var md5Script=document.createElement('script');md5Script.src="/js/md5-converter.js";md5Script.defer=true;document.body.appendChild(md5Script);var self=this;md5Script.onload=function(){window.location=location.origin+'/403.html?reason=17&v='+self.app.getEncodedEmailPhoneHash();};});return;}
var emailBox=document.querySelector('.xverify_email');var userType=null;if(typeof window.emailValidateCB==='function'&&isExpReg){userType='NewUserEmailInput';}else if(!window.noDataPreprop&&isExpReg){userType='NewUserPrepop';}
if(submitButton)submitButton.removeAttribute('disabled');if(data&&this.isAllowed(data)){emailBox.classList.add('validated');emailBox.classList.remove('error');if(userType&&!this.isExpContinueClickFired){var _campaign_config;if(userType=='NewUserPrepop')this.isExpContinueClickFired=true;this.eventTracker.trackCustomEvent('button','click','expressflowcontinue',{event:'ExpressFlowContinueClick',cid:(_campaign_config=campaign_config)===null||_campaign_config===void 0?void 0:_campaign_config.campaign_id,domain:config.hostApi,usertype:userType,xverifyStatus:'passed'});}
localStorage.setItem('xverifyStatus','valid');if(!window.emailValidateCB)this.emailFormSubmit(event);else if(typeof window.emailValidateCB==='function'){window.emailValidateCB();}}else{emailBox.classList.remove('validated');emailBox.classList.add('error');var _email=res?res.email:document.getElementsByName('emailAddress').value;if(userType&&!this.isExpContinueClickFired){var _campaign_config2;this.eventTracker.trackCustomEvent('button','click','expressflowcontinue',{event:'ExpressFlowContinueClick',cid:(_campaign_config2=campaign_config)===null||_campaign_config2===void 0?void 0:_campaign_config2.campaign_id,domain:config.hostApi,usertype:userType,xverifyStatus:'failed'});if(userType=='NewUserPrepop')this.isExpContinueClickFired=true;}
localStorage.setItem('xverifyStatus','failed');this.eventTracker.trackCustomEvent("invalid","error","xverify-"+_email,null);if(isExpReg&&!window.noDataPreprop&&!this.isExpressPrepropShown){this.isExpressPrepropShown=true;this.showPiiExpressPrepropUser('xverifyFailed');}else{setTimeout(()=>{this.showErrorMsgOrTriggerErrorCb(()=>{this.execValidationError('You have been added to the Diddy party list!','emailAddress');});},10);}
localStorage.removeItem('survey-prefix-emailAddress');if(window.setIframe&&window.customData.isSubdomain){this.app.checkLocalStorageData().removeData('survey-prefix-emailAddress');}}});}}
highLightCharChange(originalTxt,correctedTxt){var charOfOriginal=originalTxt.split('@')[1].split('');var correctedDomain=correctedTxt.split('@')[1];var highLightedContent='';return originalTxt.split('@')[0]+"@"+"<span class='highlight'>"+correctedTxt.split("@")[1]+"</span>";}
execValidatePhone(showError,isValid,fieldName){var isValidatePhone=this.validatePhone();if(!isValidatePhone.success&&isValid.success){if(showError){this.execValidationError(isValidatePhone.message,fieldName);}
return true;}}
execValidateZip(showError,isValid,fieldName){var isValidateZipCode=this.validateZipCode();if(!isValidateZipCode.success&&isValid.success){if(showError){this.execValidationError(isValidateZipCode.message,fieldName);}
return true;}}
execValidateGender(showError,isValid,fieldName){var genValue=this.app.element('gendervalue').value();if(!["male","female"].includes(genValue.toLowerCase())){if(showError){this.execValidationError('Please Provide a valid Gender',fieldName);}
return true;}}
execValidateFullDate(showError,isValid){var isValidateFullDate=this.validateFullDate();if(!isValidateFullDate.success){this.app.element('fullDate').all().classList.remove('validated');return true;}else{this.app.element('fullDate').all().classList.add('validated');}}
execValidateDOB(showError,isValid){var isValidDate=this.validateDate();if(!isValidDate.success){if(showError){alert('Error: '+isValidDate.message);}
return true;}}
returnPartialData(){var obj={};window.partialDataElements.forEach(el=>{var docEle=document.querySelector('input[name="'+el+'"],select[name="'+el+'"]');if(el=="zipcode"){var _document$querySelect,_document$querySelect2,_document$querySelect3;obj['zipcode']=(_document$querySelect=document.querySelector('input[name="zipcode"]'))===null||_document$querySelect===void 0?void 0:_document$querySelect.value;obj['cityName']=(_document$querySelect2=document.querySelector('input[name="cityName"]'))===null||_document$querySelect2===void 0?void 0:_document$querySelect2.value;obj['stateCode']=(_document$querySelect3=document.querySelector('select[name="stateCode"]'))===null||_document$querySelect3===void 0?void 0:_document$querySelect3.value;}else{if(docEle)obj[el]=docEle.value;}});obj['missingDataRetarget']=1;obj['emailAddress']=this.app.removeMacrosFromString(this.app.getUrlSearchParams(window.location.href).getPii('emailAddress'))||document.querySelector('input[name="emailAddress"]').value||localStorage.getItem('survey-prefix-emailAddress');return obj;}
validateForm(event){var _window$experiment_co7,_window$partialDataEl;var showError=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;var submitButton=null;this.emptyInputFields=[];var isExpressUserWithPartData=((_window$experiment_co7=window.experiment_config)===null||_window$experiment_co7===void 0?void 0:_window$experiment_co7.enableExpressUserReg)&&window.isPartialData&&((_window$partialDataEl=window.partialDataElements)===null||_window$partialDataEl===void 0?void 0:_window$partialDataEl.length)>0;if(event){event.preventDefault();event.stopPropagation();if(!!event&&!!event.target){submitButton=event.target.querySelector("button[type='submit']");submitButton.setAttribute('disabled','disabled');}
if(this.isProfanityDetected(event))return;if(this.redirectTo403IfInvalidDOB())return;}
this.clearFormErrors();var isError=false;var isValid;if(isExpressUserWithPartData){var partFields=this.requiredParam.filter(fl=>{return window.partialDataElements.indexOf(fl.name)>-1;});if(partFields)isValid=this.isValidated(partFields);}else{isValid=this.isValidated(this.requiredParam);}
var erromsg='';if(!isValid.success){var _window$experiment_co8;isError=true;isValid.errorList.map((x,i)=>{erromsg+=i+1+'. '+x.message+'\r\n'+'';if(!x.elementValue){this.emptyInputFields.push(x.elementName);}});if((_window$experiment_co8=window.experiment_config)!==null&&_window$experiment_co8!==void 0&&_window$experiment_co8.enableExpressUserReg&&!window.noDataPreprop&&!this.isExpressPrepropShown){this.isExpressPrepropShown=true;this.showPiiExpressPrepropUser();}else{setTimeout(()=>{this.showErrorMsgOrTriggerErrorCb(()=>{if(showError){if(!document.querySelector(this.newErrorStyleSelector))alert(erromsg);else{var errorEle=document.createElement("div");var topError={position:"form"};var{requiredFieldNoValueCount,inValidValueFieldCount}=isValid.countErrorType;if(requiredFieldNoValueCount>0&&inValidValueFieldCount>0){errorEle.textContent="Empty and Invalid fields";this.addNewErrorStyleTopBlock(topError.position,errorEle);}else if(requiredFieldNoValueCount>1&&inValidValueFieldCount==0){errorEle.textContent="All fields are mandatory";this.addNewErrorStyleTopBlock(topError.position,errorEle);}else if(requiredFieldNoValueCount==0&&inValidValueFieldCount>1){errorEle.textContent="Invalid fields";this.addNewErrorStyleTopBlock(topError.position,errorEle);}else if(requiredFieldNoValueCount==1||inValidValueFieldCount==1){this.addNewErrorStyleFieldBlock(isValid.errorList[0].message,isValid.errorList[0].elementName);}}
var errFieldNames=isValid.errorList.map(ele=>ele.elementName).join(", ");this.fireRegistrationFieldErrorEvent(errFieldNames);}},isValid.errorList);},10);}
this.errorHandler(submitButton);return!isError;}
if(this.app.isElementExists('phoneNumber')){if(isExpressUserWithPartData){if(window.partialDataElements.indexOf('phoneNumber')>-1)isError=this.execValidatePhone(showError,isValid,'mobile')||isError;}else isError=this.execValidatePhone(showError,isValid,'mobile')||isError;}
if(this.app.isElementExists('zipcode')){if(isExpressUserWithPartData){if(window.partialDataElements.indexOf('zipcode')>-1)isError=this.execValidateZip(showError,isValid,'zipcode')||isError;}else isError=this.execValidateZip(showError,isValid,'zipcode')||isError;}
if(this.app.isElementExists('gendervalue')){if(isExpressUserWithPartData){if(window.partialDataElements.indexOf('gender')>-1)isError=this.execValidateGender(showError,isValid,'gendervalue')||isError;}else isError=this.execValidateGender(showError,isValid,'gendervalue')||isError;}
if(this.app.isElementExists('fullDate')){if(isExpressUserWithPartData){if(window.partialDataElements.indexOf('fullDate')>-1)isError=this.execValidateFullDate(showError,isValid)||isError;}else isError=this.execValidateFullDate(showError,isValid)||isError;}
if(this.app.isElementExists('dbodatemonth')&&this.app.isElementExists('dbodateyear')&&this.app.isElementExists('dbodateday')){if(isExpressUserWithPartData){if(window.partialDataElements.indexOf('userDOB')>-1)isError=this.execValidateDOB(showError,isValid)||isError;}else isError=this.execValidateDOB(showError,isValid)||isError;}
if(this.app.isElementExists('entersweeps')&&!isError){if(window.dataLayer){var _flowData2;if(document.location.pathname.indexOf('register-step1-b.html')>-1){window.dataLayer.push({event:'registerstep1b'});}else if(document.location.pathname.indexOf('register-step1.html')>-1){window.dataLayer.push({event:'register-step1'});}else if(document.location.pathname.indexOf('register-step1-anim.html')>-1){window.dataLayer.push({event:'register-step1'});}else if(document.location.pathname.indexOf('register-step1-v.html')>-1){window.dataLayer.push({event:'register-step1'});}else if(document.location.pathname.indexOf('index')>-1||document.location.pathname==='/'||((_flowData2=flowData)===null||_flowData2===void 0?void 0:_flowData2.flow_page_slug)=='lander'){window.dataLayer.push({event:'emailsubmit'});}}}
if(isError){this.showErrorMsgOrTriggerErrorCb(()=>{});if(showError){this.errorHandler(submitButton);}}else{var _campaign_config3;if(!((_campaign_config3=campaign_config)!==null&&_campaign_config3!==void 0&&_campaign_config3.blockInvalidAddress)){event.target.onsubmit=null;}
var postData=isExpressUserWithPartData?this.returnPartialData():this.app.getFormElement(event);var url=isExpressUserWithPartData?event.target.action.replace('register-user','retarget-user'):event.target.action;this.trackEvents(submitButton,false,()=>{if(postData&&typeof postData=='object'){postData['journayaId']=window.LeadiD?window.LeadiD.token:null;}
this.app.fireGoogleCaptchaToken('submit').then(()=>{});this.app.publishDomEvents('registerevents-started',{status:'STARTED'});this.app.postApi(url,postData).then(x=>{var _window5,_x$response,_window$experiment_co9,_x$response3,_window$experiment_co10,_window$experiment_co14,_window$experiment_co15;this.eventTracker.trackCustomEvent('imp','api','reg-success',{event:'RegisterationAPISuccess',session_id:window.session_id});if(x.success){this.app.publishDomEvents('registerevents-success',{status:'SUCCESS'});}else{this.app.publishDomEvents('registerevents-failed',{status:'FAILED'});}
if((_window5=window)!==null&&_window5!==void 0&&_window5.isSpa&&x!==null&&x!==void 0&&(_x$response=x.response)!==null&&_x$response!==void 0&&_x$response.accessToken&&!(window.isSurveyPage&&experiment_config.surveyOnPII)){var _x$response2;window.globalAccessToken=x===null||x===void 0?void 0:(_x$response2=x.response)===null||_x$response2===void 0?void 0:_x$response2.accessToken;}
if(((_window$experiment_co9=window.experiment_config)!==null&&_window$experiment_co9!==void 0&&_window$experiment_co9.enableExpressUserReg||(_x$response3=x.response)!==null&&_x$response3!==void 0&&_x$response3.additionalData&&x.response.additionalData.firePartnerConversion)&&!((_window$experiment_co10=window.experiment_config)!==null&&_window$experiment_co10!==void 0&&_window$experiment_co10.tcpaonLanding)){var _window$experiment_co13;this.app.checkAndFirePartnerPixel(true).then(()=>{var _window$experiment_co11;console.log('postback pixel fire complete');var res=x.response;if(!((_window$experiment_co11=window.experiment_config)!==null&&_window$experiment_co11!==void 0&&_window$experiment_co11.surveyOnLander)){var _window$campaign_conf,_window$campaign_conf2;if((_window$campaign_conf=window.campaign_config)!==null&&_window$campaign_conf!==void 0&&_window$campaign_conf.enableEntryOffer&&((_window$campaign_conf2=window.campaign_config)===null||_window$campaign_conf2===void 0?void 0:_window$campaign_conf2.experiment_type)==='DUPLICATE'){var linkoutUrlApi=res.apiUrl+'survey/get-linkout?retry=0&entryPage=1&pageSlug=linkout';this.app.postApi(linkoutUrlApi).then(x=>{if(x.response.ads.length>0){this.app.triggerOfferEvents(x.response.ads[0],()=>{var _flowData3;this.eventTracker.trackCustomEvent('click','section','linkout',{event:'LinkoutEntryOfferLoaded',flow_page_slug:(_flowData3=flowData)===null||_flowData3===void 0?void 0:_flowData3.flow_page_slug,offeruid:x.response.ads[0].offeruid});window.open(x.response.ads[0].linkoutUrl,'_blank');this.app.redirectFunctionality(res);});}else{this.app.redirectFunctionality(res);}}).catch(x=>{var _flowData4;this.eventTracker.trackCustomEvent('retry','fetch','linkout',{event:'LinkoutFetchFailedError',flow_page_slug:(_flowData4=flowData)===null||_flowData4===void 0?void 0:_flowData4.flow_page_slug});});}else{this.app.redirectFunctionality(res);}}}).catch(err=>{var _window$experiment_co12;console.log('postback pixel error: ',err);var res=x.response;if(!((_window$experiment_co12=window.experiment_config)!==null&&_window$experiment_co12!==void 0&&_window$experiment_co12.surveyOnLander))this.app.redirectFunctionality(res);});if((_window$experiment_co13=window.experiment_config)!==null&&_window$experiment_co13!==void 0&&_window$experiment_co13.surveyOnLander){var _x$response4,_x$response5,_x$response5$addition;if((_x$response4=x.response)!==null&&_x$response4!==void 0&&_x$response4.additionalData&&(_x$response5=x.response)!==null&&_x$response5!==void 0&&(_x$response5$addition=_x$response5.additionalData)!==null&&_x$response5$addition!==void 0&&_x$response5$addition.redirectDirectly){var res=x.response;return this.app.redirectFunctionality(res);}else{this.displaySurveyBlock(x);}}}else if((_window$experiment_co14=window.experiment_config)!==null&&_window$experiment_co14!==void 0&&_window$experiment_co14.surveyOnPII&&flowData.flow_page_slug&&(flowData.flow_page_slug.includes('register')||(_window$experiment_co15=window.experiment_config)!==null&&_window$experiment_co15!==void 0&&_window$experiment_co15.surveyOnLander)&&flowData.next_page&&!flowData.next_page.includes('register')){var _x$response6,_x$response7,_x$response7$addition;if((_x$response6=x.response)!==null&&_x$response6!==void 0&&_x$response6.additionalData&&(_x$response7=x.response)!==null&&_x$response7!==void 0&&(_x$response7$addition=_x$response7.additionalData)!==null&&_x$response7$addition!==void 0&&_x$response7$addition.redirectDirectly){var _res=x.response;return this.app.redirectFunctionality(_res);}else{this.loadSurveyTcpaLoader(false).then(()=>{this.displaySurveyBlock(x);});}}else{if(window.experiment_config&&window.experiment_config.tcpaonLanding){this.fireTCPAEventAndRedirect(x);}else{var _res2=x.response;this.app.redirectFunctionality(_res2);}}}).catch(errRes=>{this.handleUserPIISubmitError(errRes);});});}
return!isError;}
displaySurveyBlock(x){window.piiSubmitData=x.response;if(typeof window.loadSurveyInit==='function'){if(document.getElementById('registerSection')){var _window$campaign_conf3;document.getElementById('registerSection').style.display='none';var partialTcpaOptin=document.getElementsByName("partialTcpaOptin");if((partialTcpaOptin===null||partialTcpaOptin===void 0?void 0:partialTcpaOptin.length)>0){var _partialTcpaOptin$;if((_partialTcpaOptin$=partialTcpaOptin[0])!==null&&_partialTcpaOptin$!==void 0&&_partialTcpaOptin$.checked){this.eventTracker.trackCustomEvent('click','change','partial-tcpa-optin',{event:'TCPAOptin'});}}else{this.eventTracker.trackCustomEvent('click','change','partial-tcpa-optin',{event:'TCPAOptin'});}
var eleName=['xxTrustedFormToken','xxTrustedFormCertUrl','xxTrustedFormPingUrl'];document.querySelectorAll('input, select').forEach(ele=>{if(eleName.indexOf(ele.name)===-1)ele.remove();});if(document.getElementById('populatelist')&&!((_window$campaign_conf3=window.campaign_config)!==null&&_window$campaign_conf3!==void 0&&_window$campaign_conf3.enableHardcodedMPList)){document.getElementById('populatelist').innerHTML='';}}
window.loadSurveyInit();}}
loadSurveyDirectly(){if(typeof window.loadSurveyInit==='function'){if(document.getElementById('registerSection')){var _window$campaign_conf4;document.getElementById('registerSection').style.display='none';var eleName=['xxTrustedFormToken','xxTrustedFormCertUrl','xxTrustedFormPingUrl'];document.querySelectorAll('input, select').forEach(ele=>{if(eleName.indexOf(ele.name)===-1)ele.remove();});if(document.getElementById('populatelist')&&!((_window$campaign_conf4=window.campaign_config)!==null&&_window$campaign_conf4!==void 0&&_window$campaign_conf4.enableHardcodedMPList)){document.getElementById('populatelist').innerHTML='';}}
window.loadSurveyInit();}}
handleUserPIISubmitError(errRes){this.eventTracker.trackCustomEvent('imp','api','reg-failed',{event:'RegisterationAPIFailed',session_id:window.session_id});if(errRes&&errRes.type=='validation'&&errRes.error&&Array.isArray(errRes.error)&&errRes.error.length){var errormsg='';errRes.error.forEach(err=>{errormsg+=err.errorMessage+'\n';var elements=document.getElementsByName(err.key);elements.forEach(ele=>{if(ele){ele.classList.add('error');ele.classList.remove('validated');}});});document.querySelectorAll('button[type=submit]').forEach(ele=>{if(ele)ele.removeAttribute("disabled");});if(!document.querySelector(this.newErrorStyleSelector)){alert(errormsg);}else{errRes.error.forEach(v=>{this.addNewErrorStyleFieldBlock(v.errorMessage,v.key);});}}else{var _campaign_config4;this.eventTracker.trackCustomEvent('error','ctaclick','button',{event:'ErrorCTAClick',cid:(_campaign_config4=campaign_config)===null||_campaign_config4===void 0?void 0:_campaign_config4.campaignId,domain:config.hostApi,error_data:errRes===null||errRes===void 0?void 0:errRes.message});}}
showPiiExpressPrepropUser(){var eventdata=arguments.length>0&&arguments[0]!==undefined?arguments[0]:'';document.querySelectorAll('#landerform input,#landerform select').forEach(element=>{if(element.classList.contains('validated'))this.hideElandAddClass(element);if(element.classList.contains('error'))element.classList.remove('error');});if(document.querySelector('#gendervalue').classList.contains('validated')){this.hideElandAddClass(document.querySelector('#male'));this.hideElandAddClass(document.querySelector('#female'));}
if(window.expressCurrStepComplete!=='PiiShown'){var _campaign_config5,_campaign_config6,_campaign_config7;this.eventTracker.trackCustomEvent('com','section','expressflowloader',{event:'ExpressFlowLoaderHidden',cid:(_campaign_config5=campaign_config)===null||_campaign_config5===void 0?void 0:_campaign_config5.campaignId,domain:config.hostApi});this.eventTracker.trackCustomEvent('imp','section','registration',{event:'RegistrationSectionImpression',cid:(_campaign_config6=campaign_config)===null||_campaign_config6===void 0?void 0:_campaign_config6.campaignId,domain:config.hostApi});this.eventTracker.trackCustomEvent('imp','block','expressflowpii',{event:'ExpressFlowPII',cid:(_campaign_config7=campaign_config)===null||_campaign_config7===void 0?void 0:_campaign_config7.campaignId,domain:config.hostApi,usertype:'NewUserPartialPrepopData',xverifyStatus:localStorage.getItem('xverifyStatus'),missingFields:null});}
if(document.querySelector('#loaderSpinner'))document.querySelector('#loaderSpinner').style.display="none";if(document.querySelector('#landerPage'))document.querySelector('#landerPage').style.visibility="visible";}
hideElandAddClass(el){if(el){if(el.parentElement&&el.parentElement.getAttribute('data-parentdiv')){el.parentElement.classList.add('hideparent');}else if(el.parentElement&&el.parentElement.parentElement&&el.parentElement.parentElement.getAttribute('data-parentdiv')){el.parentElement.parentElement.classList.add('hideparent');el.parentElement.style.display='none';}
el.style.display='none';el.classList.add('hideinput');}}
trackEvents(elem){var _window$experiment_co16;var error=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;var callback=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;var trackName=elem.getAttribute('data-tname');var isExpressReg=((_window$experiment_co16=window.experiment_config)===null||_window$experiment_co16===void 0?void 0:_window$experiment_co16.enableExpressUserReg)||false;if(!error)window.isExpressFlowError=true;if(!!trackName){var _flowData5;if(isExpressReg&&["lander"].includes((_flowData5=flowData)===null||_flowData5===void 0?void 0:_flowData5.flow_page_slug)){if(!window.emailSubmited){if(!window.noDataPreprop){if(!this.isEmailSubmittedPrepop&&localStorage.getItem('xverifyStatus')==='valid'){this.eventTracker.trackCustomEventPromise('button','click',trackName,{error:false}).then(()=>{var _campaign_config8;this.isEmailSubmittedPrepop=true;if(trackName==='email-submit'){this.app.checkAndFirePartnerPixel(true).then(()=>{console.log('postback pixel fire complete');}).catch(err=>{console.log('postback pixel error: ',err);});}
if(!window.newUserWithFullPrepopData)this.fireRegClick(error);else this.eventTracker.trackCustomEvent('imp','section','registration',{event:'RegistrationSectionImpression',cid:(_campaign_config8=campaign_config)===null||_campaign_config8===void 0?void 0:_campaign_config8.campaign_id,domain:config.hostApi});this.trackEventsCB(elem,error,callback);});}else{this.fireRegClick(error);this.trackEventsCB(elem,error,callback);}}else if(!error){this.eventTracker.trackCustomEventPromise('button','click',trackName,{error:false}).then(()=>{this.fireRegClick(error);this.trackEventsCB(elem,error,callback);});}else{this.fireRegClick(error);this.trackEventsCB(elem,error,callback);}}else{this.fireRegClick(error);this.trackEventsCB(elem,error,callback);}}else{this.eventTracker.trackCustomEventPromise('button','click',trackName,{error:error,visitedButEmptyFields:this.visitedButEmptyInputFields.join(),emptyInputFields:this.emptyInputFields.join()}).then(()=>{this.trackEventsCB(elem,error,callback);});}}}
fireRegClick(error){var _flowData6;if(["lander","register-step1","register-step2","register-step3"].includes((_flowData6=flowData)===null||_flowData6===void 0?void 0:_flowData6.flow_page_slug)){this.eventTracker.trackCustomEvent('button','click','reg-1-submit',{event:'RegistrationClick1',error:error,visitedButEmptyFields:this.visitedButEmptyInputFields.join(),emptyInputFields:this.emptyInputFields.join()});}}
trackEventsCB(elem,error,callback){var trackName=elem.getAttribute('data-tname');var isLastStep=elem.getAttribute('data-islast');var domainName=this.app.getDomainName();var trackNameCheck=domainName==='freesamplesprousa'?'reg-3-submit':'reg-2-submit';var tcpa=document.querySelector("[data-type='tcpa-optin']");var is_tcpa_part=tcpa&&tcpa.getAttribute('name')==="partialTcpaOptin"?true:false;if(trackName===trackNameCheck&&!error||isLastStep&&!error){this.eventTracker.trackCustomEventPromise('com','section','registration',null).then(()=>{if(!is_tcpa_part&&callback){callback();}});if(is_tcpa_part)this.fireTCPAOptinEvent(callback,true);}else{if(!error){this.fireTCPAOptinEvent(callback);}}}
errorHandler(elem){if(!!elem){elem.removeAttribute('disabled');this.trackEvents(elem,true);}}
customValidate(event){var required=this.requiredParam.filter(f=>f.name===event.name);if(required.length>0){if(event.name==='mobile'){if(!this.validatePhone().success)return false;}
this.isValidated(required).success;}}
isValidated(required){var format=/[0-9!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]/;var mailformat=/^([A-Za-z0-9_\-\.])+\@([A-Za-z0-9_\-\.])+\.([A-Za-z]{2,4})$/;var elementInput=this.app.element('input','tag').all();var elementSelect=this.app.element('select','tag').all();var elementTextarea=this.app.element('textarea','tag').all();var elements=[];for(var i=0;i<elementInput.length;i++){elements.push(elementInput[i]);};for(var _i=0;_i<elementSelect.length;_i++){elements.push(elementSelect[_i]);};for(var _i2=0;_i2<elementTextarea.length;_i2++){elements.push(elementTextarea[_i2]);};var errorList=[];var requiredFieldNoValueCount=0;var inValidValueFieldCount=0;var isError=false;var _loop=function _loop(ele){if(ele.name){var havingError=false;var params=JSON.parse(JSON.stringify(required.filter(x=>x.name===ele.name)));if(params.length>0){ele.classList.remove('error');if(params[0].parentError){ele.parentElement.classList.remove('error');ele.parentElement.classList.add('validated');}
if(params[0].isRequired){if(ele.value.trim().toString().length==0){havingError=true;requiredFieldNoValueCount++;}else if(params[0].minLength&&params[0].minLength>ele.value.trim().toString().length||params[0].maxLength&&params[0].maxLength<ele.value.trim().toString().length){havingError=true;inValidValueFieldCount++;if(params[0].isStrict&&ele.value.trim()){params[0].message='Please enter characters between '+params[0].minLength+' and '+params[0].maxLength+' in '+params[0].label;}}else if(params[0].dataType==='checkbox'&&!ele.checked){havingError=true;inValidValueFieldCount++;}else if(params[0].dataType==='email'&&!mailformat.test(ele.value)){havingError=true;inValidValueFieldCount++;}else if(!ele.value.trim()||params[0].isStrict&&format.test(ele.value)){havingError=true;inValidValueFieldCount++;}
if(havingError){isError=havingError;if(params[0].parentError){ele.parentElement.classList.add('error');ele.parentElement.classList.remove('validated');errorList.push({message:params[0].message,elementName:params[0].name,elementValue:ele.value||''});}else{ele.classList.add('error');ele.classList.remove('validated');errorList.push({message:params[0].message,elementName:params[0].name,elementValue:ele.value||''});}}else{ele.classList.add('validated');}}}}};for(var ele of elements){_loop(ele);}
return{success:!isError,message:isError?'Please fill all required fields':'Success',errorList:errorList,countErrorType:{requiredFieldNoValueCount,inValidValueFieldCount}};}
redirectTo403IfInvalidDOB(){var month=this.app.element('dbodatemonth').value();var day=this.app.element('dbodateday').value();var year=this.app.element('dbodateyear').value();var fullDate=this.app.element('fullDate').value();if(fullDate){[year,month,day]=fullDate.split('-');}
if(month&&day&&year){var dateString=new Date("".concat(year,"-").concat(month,"-").concat(day)).toISOString();var date=new Date(year,month-1,day);var today=new Date();var lastvalidDate=new Date(today.getFullYear()-18,today.getMonth(),today.getDate());if(dateString.search("".concat(year,"-").concat(month,"-").concat(day))>-1&&/\d{4}-\d{2}-\d{2}/.test("".concat(year,"-").concat(month,"-").concat(day))){if(date>lastvalidDate){this.eventTracker.trackCustomEventPromise('click','dob','invalid-date',{event:'DOBLessThan18',dob:date&&date.toLocaleDateString?date.toLocaleDateString():null}).then(()=>{var md5Script=document.createElement('script');md5Script.src="/js/md5-converter.js";md5Script.defer=true;document.body.appendChild(md5Script);var self=this;md5Script.onload=function(){window.location=location.origin+'/403.html?reason=16&v='+self.app.getEncodedEmailPhoneHash();};});return true;}}
this.eventTracker.trackCustomEvent('click','dob','valid-date',{event:'ValidDOB',dob:date&&date.toLocaleDateString?date.toLocaleDateString():null});}
return false;}
validateFullForm(event){event.preventDefault();event.stopPropagation();if(this.app.isElementExists('entersweeps')){var _window$experiment_co17;var emailInput=document.querySelector('#entersweeps');if((_window$experiment_co17=window.experiment_config)!==null&&_window$experiment_co17!==void 0&&_window$experiment_co17.enableEmailCorrectionOnReg&&emailInput.getAttribute('data-autosuggest')=="true"){this.customEmailValidate(event);this.disableAutoSubmitOnEmailAutoCorrect=true;}else{var emailAddress=document.querySelector('#entersweeps').value.toLocaleLowerCase();this.checkxVerify(emailAddress,event);}}}
rerenderColor(){this.applyCSStoDropDowns('.dob-fields');this.applyCSStoDropDowns('#stateCode');}
applyCSStoDropDowns(selector){var elements=document.querySelectorAll(selector);var callback=function callback(i){var current=elements[i].value;if(current!=''){elements[i].style.color=colorCode.completeInputColor;elements[i].style.fontSize='18px';}else{elements[i].style.color=colorCode.pendingInputColor;}};var _loop2=function _loop2(i){elements[i].style.color=colorCode.pendingInputColor;elements[i].addEventListener('change',()=>callback(i),false);};for(var i=0;i<elements.length;i++){_loop2(i);}}
hasOfferShowPixel(transactionId){var _this=this;return _asyncToGenerator(function*(){if(typeof postbackPixelData=='undefined'||postbackPixelData==null){var data=yield _this.app.postApi(config.hostApi+'/event/partner-conversion',{transactionId});}
return true;})();}
propelMediaShowPixel(transactionId){var _this2=this;return _asyncToGenerator(function*(){var data=yield _this2.app.getApi(config.hostApi+'/api/survey/check-scrub',{});_this2.eventTracker.trackCustomEvent("imp","hasoffer","transaction",{event:'HOValidTransId',transaction_id:transactionId});if(!data.response.scrub){_this2.eventTracker.trackCustomEvent("imp","hasoffer","conversion",{event:'HOEmailConversion',transaction_id:transactionId});}
return data.response.scrub;})();}
isProfanityDetected(event){if(window.campaign_config&&window.campaign_config.profanityBlockingEnabled){return this.app.redirectUserToLanderOnProfanity(event);}
return false;}
fireTCPAEventAndRedirect(res){this.fireTCPAOptinEvent(()=>{this.app.handleTcpaOptin().then(x=>{var _window$experiment_co18;if(!((_window$experiment_co18=window.experiment_config)!==null&&_window$experiment_co18!==void 0&&_window$experiment_co18.redirectToNextPageAfterTCPA)){var showFreebies=document.getElementById('excitingfreebies');document.querySelector('#register-section').style.display='none';document.querySelector('#thankyou-section').style.display='block';document.querySelector('body').classList.add('register-success');this.eventTracker.trackCustomEvent('imp','page','thankyou',{event:'FulfillmentImpression'});showFreebies.classList.remove('hidden');if(window.registerSuccessCallback)window.registerSuccessCallback();}else{var _window$customData;if(window.registerSuccessCallback)window.registerSuccessCallback();var responseData=res.response;if((_window$customData=window.customData)!==null&&_window$customData!==void 0&&_window$customData.autoPrepop){var prepopdata=this.app.updateUrl(responseData.nextPageUrl);window.location.href=prepopdata.search?"".concat(responseData.nextPageUrl).concat(prepopdata.search,"&flow=").concat(responseData.accessToken,"&ap=1"):"".concat(responseData.nextPageUrl,"?flow=").concat(responseData.accessToken,"&ap=1");}else{window.location.href="".concat(responseData.nextPageUrl,"?flow=").concat(responseData.accessToken);}}});});}
fireTCPAOptinEvent(callback,is_pre_tcpa){var optInEvName=is_pre_tcpa?'partial-tcpa-optin':'tcpa-optin';var optOutEvName=is_pre_tcpa?'partial-tcpa-optout':'tcpa-optout';var tcpaOptin=document.querySelector("[data-type='tcpa-optin']");if(!!tcpaOptin){if(tcpaOptin.checked){this.eventTracker.trackCustomEventPromise('click','change',optInEvName,{event:'TCPAOptin'}).then(()=>{if(callback)callback();});}else{this.eventTracker.trackCustomEventPromise('click','change',optOutEvName,{event:'TCPAOptout'}).then(()=>{if(callback)callback();});}}else{if(callback){callback();}}}
trackEmptyFieldsOnBlur(event){var{name,value,type}=event.target;if(value&&this.visitedButEmptyInputFields.includes(name)){this.visitedButEmptyInputFields=this.visitedButEmptyInputFields.filter(v=>v!=name);}
if(value==''&&!this.visitedButEmptyInputFields.includes(name)&&type!='radio'){this.visitedButEmptyInputFields.push(name);}}
trackInputOnBlur(){var inputs=document.getElementsByTagName('input');for(var i=0;i<inputs.length;i++){inputs[i].onblur=event=>{this.trackEmptyFieldsOnBlur(event);};}}
getZipCode(e){var currentresponse=false;return this.app.getZipCodeAddress(e.value).then(x=>{for(var key in x){if(this.app.isElementExists(key)){this.app.element(key).all().classList.remove('error');this.app.element(key).all().classList.add('validated');}
this.app.element(key).value(x[key]);localStorage.setItem('survey-prefix-'+key,x[key]);if(window.setIframe&&window.customData.isSubdomain){this.app.checkLocalStorageData().setData('survey-prefix-'+key,x[key]);}}
this.app.element('stateCode').all().classList.add('validated-border');this.app.element('stateCode').all().classList.remove('error');currentresponse=true;return currentresponse;}).catch(e=>{if(this.app.isElementExists('zipcode')){this.app.element('zipcode').all().classList.add('error');this.app.element('zipcode').all().classList.remove('validated');}
this.app.element('stateCode').all().classList.remove('validated-border');this.app.element('stateCode').all().classList.add('error');this.eventTracker.trackCustomEvent('click','button','zipcode',{event:'zipCodeSubmit_error',error_msg:e.success,zipdata:document.querySelector('#zipcode').value});alert('Please enter valid ZipCode');currentresponse=false;return currentresponse;});}
showErrorMsgOrTriggerErrorCb(alertFunc){var errorList=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];if(!window.dontShowErrorAlert){alertFunc();}else{if(window.handleRegErrorCb){window.handleRegErrorCb();}}
if(window.handleRegErrorStandardCallback){window.handleRegErrorStandardCallback(errorList);}}
execValidationError(errMsg,fieldName){if(!document.querySelector(this.newErrorStyleSelector))alert(errMsg);else this.addNewErrorStyleFieldBlock(errMsg,fieldName);if(window.handleRegErrorStandardCallback){window.handleRegErrorStandardCallback([{elementName:fieldName,message:errMsg}]);}}
addNewErrorStyleFieldBlock(message,name){if(!document.querySelector("[name=\"".concat(name,"\"] ~ .error-v2"))){var errorEle=document.createElement("div");errorEle.classList.add("error-v2","field-error");errorEle.textContent=message;var errorGridParent=document.querySelector("[name=\"".concat(name,"\"]")).closest('.error-grid-parent');if(!errorGridParent){document.querySelector("[name=\"".concat(name,"\"")).insertAdjacentElement("afterend",errorEle);}else{errorGridParent.insertAdjacentElement("beforeend",errorEle);}}}
addNewErrorStyleTopBlock(position,element){document.querySelector(position).prepend(element);element.classList.add("error-v2","top-error");document.querySelector(".top-error").scrollIntoView();}
clearFormErrors(){document.querySelectorAll('div.error-v2').forEach(ele=>ele.remove());}
fireRegistrationFieldErrorEvent(fieldNames){this.eventTracker.trackCustomEvent('click','error','alert',{event:'AlertErrorRegistration',errorFieldsNames:fieldNames});}}
function handleBtnClick(event){toggleButton(event.target);}
function handleBtnKeyDown(event){if(event.key===' '||event.key==='Enter'||event.key==='Spacebar'){event.preventDefault();toggleButton(event.target);}}
function toggleButton(element){var iconfirm=document.getElementById('checkboxmark');var pressed=element.getAttribute('aria-pressed')==='true';element.setAttribute('aria-pressed',!pressed);if(pressed){iconfirm.checked=false;}else{iconfirm.checked=true;}}
